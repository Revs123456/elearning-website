<div id="courses-content">
  <div class="courses-hero">
    <h1>Explore Our Courses</h1>
    <p>Enhance your skills with our expert-led courses</p>
  </div>

  <div class="courses-container">
    <div class="course-filters">
      <button class="filter-btn active">All Courses</button>
      <button class="filter-btn">Web Development</button>
      <button class="filter-btn">Mobile Development</button>
      <button class="filter-btn">Data Science</button>
      <button class="filter-btn">Design</button>
    </div>

    <div class="course-grid" id="courses-container">
      <!-- Courses will be dynamically loaded here -->
      <div
        id="loading-message"
        style="text-align: center; width: 100%; padding: 2rem"
      >
        <p>Loading courses...</p>
      </div>
      <div
        id="no-courses-message"
        style="display: none; text-align: center; width: 100%; padding: 2rem"
      >
        <p>No courses available yet. Check back later!</p>
      </div>
    </div>
  </div>
</div>
<script>
  // --- Storage Bridge: read arrays saved by admin or legacy keys ---
  function getAdminState() {
    try {
      return JSON.parse(localStorage.getItem("elearn_admin_state_v1") || "{}");
    } catch {
      return {};
    }
  }

  function getItems(key) {
    const s = getAdminState();
    if (Array.isArray(s[key]) && s[key].length) return s[key]; // admin state wins when present
    try {
      return JSON.parse(localStorage.getItem(key) || "[]");
    } catch {
      // legacy fallback
      return [];
    }
  }

  // (Optional) keep old pages working that read legacy keys elsewhere:
  function mirrorLegacy(key) {
    const arr = getItems(key);
    try {
      localStorage.setItem(key, JSON.stringify(arr));
    } catch {}
  }
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const coursesContainer = document.getElementById("courses-container");
    const loadingMessage = document.getElementById("loading-message");
    const noCoursesMessage = document.getElementById("no-courses-message");
    const filterButtons = document.querySelectorAll(".filter-btn");

    let allCourses = [];

    function render(list) {
      // clear current course cards
      Array.from(coursesContainer.children)
        .filter(
          (c) => !["loading-message", "no-courses-message"].includes(c.id)
        )
        .forEach((c) => c.remove());

      if (!list.length) {
        noCoursesMessage.style.display = "block";
        return;
      }
      noCoursesMessage.style.display = "none";

      list.forEach((course) => {
        const img =
          course.image ||
          `https://source.unsplash.com/600x400/?${encodeURIComponent(
            course.category || "learning"
          )}&sig=${Math.random()}`;
        const card = document.createElement("div");
        card.className = "course-card";
        card.innerHTML = `
          <div class="course-thumbnail" style="background-image:url('${img}')">
            <i class="fas fa-graduation-cap"></i>
          </div>
          <div class="course-content">
            <span class="course-category">${course.category || "General"}</span>
            <h3 class="course-title">${course.title || "Untitled Course"}</h3>
            <p>${course.description || "No description available."}</p>
            <div class="course-meta">
              <span><i class="fas fa-chalkboard-teacher"></i> ${
                course.instructor || "Instructor"
              }</span>
              <span><i class="fas fa-star"></i> ${course.status || "New"}</span>
            </div>
            <div class="course-footer">
              <button class="btn-enroll">View Details</button>
            </div>
          </div>
        `;
        coursesContainer.appendChild(card);
      });
    }

    function loadCourses() {
      loadingMessage.style.display = "block";
      noCoursesMessage.style.display = "none";

      // READ from admin storage (fallback to legacy)
      allCourses = getItems("courses");

      loadingMessage.style.display = "none";
      if (!allCourses.length) {
        noCoursesMessage.style.display = "block";
        return;
      }
      render(allCourses);
    }

    // Filters: use button text to filter by category
    function applyFilter(catText) {
      if (catText === "All Courses") return render(allCourses);
      const filtered = allCourses.filter(
        (c) => (c.category || "").toLowerCase() === catText.toLowerCase()
      );
      render(filtered);
    }

    // events
    filterButtons.forEach((btn) => {
      btn.addEventListener("click", function () {
        filterButtons.forEach((b) => b.classList.remove("active"));
        this.classList.add("active");
        applyFilter(this.textContent.trim());
      });
    });

    // initial
    loadCourses();
    mirrorLegacy("courses"); // optional syncing
  });
</script>

<style>
  .courses-hero {
    background: linear-gradient(135deg, #49bbbd, #2c3e50);
    color: white;
    padding: 3rem 2rem;
    text-align: center;
    margin-bottom: 2rem;
    border-radius: 8px;
  }

  .courses-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .course-filters {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .filter-btn {
    padding: 0.5rem 1.5rem;
    border: 1px solid #ddd;
    background: white;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .filter-btn:hover,
  .filter-btn.active {
    background: #49bbbd;
    color: white;
    border-color: #49bbbd;
  }

  .course-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
  }

  .course-card {
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease;
  }

  .course-card:hover {
    transform: translateY(-5px);
  }

  .course-thumbnail {
    height: 160px;
    background: #f5f7fa;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3rem;
    color: #49bbbd;
    position: relative;
  }

  .course-badge {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: #ff6b6b;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-size: 0.8rem;
  }

  .course-content {
    padding: 1.5rem;
  }

  .course-category {
    color: #49bbbd;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
    display: block;
  }

  .course-title {
    font-size: 1.25rem;
    margin: 0.5rem 0;
  }

  .course-meta {
    display: flex;
    justify-content: space-between;
    color: #666;
    font-size: 0.9rem;
    margin: 1rem 0;
  }

  .course-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 1rem;
    border-top: 1px solid #eee;
  }

  .course-price {
    font-weight: bold;
    font-size: 1.25rem;
    color: #2c3e50;
  }

  .btn-enroll {
    background: #49bbbd;
    color: white;
    border: none;
    padding: 0.5rem 1.5rem;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  .btn-enroll:hover {
    background: #3aa8aa;
  }
</style>

<script>
  // Filter courses functionality
  document.addEventListener("DOMContentLoaded", function () {
    const filterBtns = document.querySelectorAll(".filter-btn");
    filterBtns.forEach((btn) => {
      btn.addEventListener("click", function () {
        filterBtns.forEach((b) => b.classList.remove("active"));
        this.classList.add("active");
        // Here you would filter courses based on the selected category
        // For now, we're just updating the UI
      });
    });
  });
</script>
