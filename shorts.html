<div id="shorts-content">
  <div class="shorts-container">
    <div class="shorts-header">
      <h2>Learning Shorts</h2>
      <a href="admin.html#shorts-section" class="btn-primary"> </a>
    </div>

    <!-- Loading State -->
    <div id="loading-state" class="loading-state">
      <div class="spinner"></div>
      <p>Loading shorts...</p>
    </div>

    <!-- Empty State -->
    <div id="empty-state" class="empty-state">
      <i class="fas fa-video"></i>
      <h3>No Shorts Found</h3>
      <p>Get started by adding your first short video</p>
      <a href="admin.html#shorts-section" class="btn-primary">
        <i class="fas fa-plus"></i> Add Short
      </a>
    </div>

    <!-- Shorts Grid -->
    <div id="shorts-grid" class="shorts-grid">
      <!-- Shorts will be loaded here by JavaScript -->
    </div>
  </div>
</div>

<style>
  .shorts-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .shorts-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .shorts-filter {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .filter-btn {
    padding: 0.5rem 1.5rem;
    border: 1px solid #ddd;
    background: white;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .filter-btn:hover,
  .filter-btn.active {
    background: #49bbbd;
    color: white;
    border-color: #49bbbd;
  }

  .shorts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;
  }

  .short-card {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease;
  }

  .short-card:hover {
    transform: translateY(-5px);
  }

  .short-thumbnail {
    position: relative;
    height: 500px;
    background: #f5f7fa;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #666;
  }

  .short-thumbnail i {
    font-size: 3rem;
    color: #49bbbd;
  }

  .short-duration {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-size: 0.9rem;
  }

  .short-info {
    padding: 1rem;
  }

  .short-creator {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }

  .creator-avatar {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    object-fit: cover;
  }

  .short-stats {
    display: flex;
    gap: 1rem;
    color: #666;
    font-size: 0.9rem;
    margin-top: 0.5rem;
  }

  .short-stats span {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .load-more {
    text-align: center;
    margin: 2rem 0;
  }

  .btn-load-more {
    background: #49bbbd;
    color: white;
    border: none;
    padding: 0.75rem 2rem;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1rem;
    transition: background 0.3s ease;
  }

  .btn-load-more:hover {
    background: #3aa8aa;
  }
</style>
<script>
  // --- Storage Bridge: read arrays saved by admin or legacy keys ---
  function getAdminState() {
    try {
      return JSON.parse(localStorage.getItem("elearn_admin_state_v1") || "{}");
    } catch {
      return {};
    }
  }

  function getItems(key) {
    const s = getAdminState();
    if (Array.isArray(s[key]) && s[key].length) return s[key]; // admin state wins when present
    try {
      return JSON.parse(localStorage.getItem(key) || "[]");
    } catch {
      // legacy fallback
      return [];
    }
  }

  // (Optional) keep old pages working that read legacy keys elsewhere:
  function mirrorLegacy(key) {
    const arr = getItems(key);
    try {
      localStorage.setItem(key, JSON.stringify(arr));
    } catch {}
  }
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const shortsGrid = document.getElementById("shorts-grid");
    const loadingState = document.getElementById("loading-state");
    const emptyState = document.getElementById("empty-state");

    // Background colors for short thumbnails
    const thumbnailColors = [
      "linear-gradient(135deg, #FFE0B2, #FFB74D)",
      "linear-gradient(135deg, #B3E5FC, #4FC3F7)",
      "linear-gradient(135deg, #C8E6C9, #81C784)",
      "linear-gradient(135deg, #F8BBD0, #F06292)",
      "linear-gradient(135deg, #D1C4E9, #9575CD)",
    ];

    // Load shorts from localStorage
    function loadShorts() {
      loadingState.style.display = "flex";
      emptyState.style.display = "none";
      shortsGrid.innerHTML = "";

      // Simulate loading
      setTimeout(() => {
        try {
          const shorts = JSON.parse(localStorage.getItem("shorts") || "[]");

          if (shorts.length === 0) {
            showEmptyState();
          } else {
            displayShorts(shorts);
            emptyState.style.display = "none";
          }
        } catch (error) {
          console.error("Error loading shorts:", error);
          showEmptyState("Error loading shorts");
        } finally {
          loadingState.style.display = "none";
        }
      }, 500);
    }

    // Display shorts in the grid
    function displayShorts(shorts) {
      shortsGrid.innerHTML = "";

      shorts.forEach((short, index) => {
        const color = thumbnailColors[index % thumbnailColors.length];
        const shortCard = createShortCard(short, color);
        shortsGrid.appendChild(shortCard);
      });
    }

    // Create a short card element
    function createShortCard(short, color) {
      const card = document.createElement("div");
      card.className = "short-card";

      // Format the duration
      const duration = formatDuration(short.duration || 0);

      card.innerHTML = `
                <div class="short-thumbnail" style="background: ${color};">
                    <i class="fas fa-play"></i>
                    <span class="short-duration">${duration}</span>
                </div>
                <div class="short-info">
                    <div class="short-creator">
                        <img src="https://i.pravatar.cc/30?img=${
                          Math.floor(Math.random() * 10) + 1
                        }" 
                             alt="${
                               short.creator || "Creator"
                             }" class="creator-avatar">
                        <span>${short.creator || "Creator"}</span>
                    </div>
                    <h3>${short.title || "Untitled Short"}</h3>
                    <div class="short-stats">
                        <span><i class="far fa-eye"></i> ${formatNumber(
                          short.views || 0
                        )}</span>
                        <span><i class="far fa-thumbs-up"></i> ${formatNumber(
                          short.likes || 0
                        )}</span>
                        <span><i class="far fa-comment"></i> ${formatNumber(
                          short.comments || 0
                        )}</span>
                    </div>
                </div>
            `;

      // Add click handler to play the short
      card.addEventListener("click", () => {
        // In a real app, this would open the short in a player
        console.log("Playing short:", short.title || "Untitled");
      });

      return card;
    }

    // Format duration in MM:SS format
    function formatDuration(seconds) {
      if (!seconds) return "0:00";
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs < 10 ? "0" : ""}${secs}`;
    }

    // Format large numbers (e.g., 1200 -> 1.2k)
    function formatNumber(num) {
      if (num >= 1000000) {
        return (num / 1000000).toFixed(1) + "M";
      } else if (num >= 1000) {
        return (num / 1000).toFixed(1) + "k";
      }
      return num;
    }

    function showEmptyState(message = "No shorts found") {
      emptyState.querySelector("h3").textContent = message;
      emptyState.style.display = "flex";
      shortsGrid.style.display = "none";
    }

    // Initial load
    loadShorts();
  });
</script>

<style>
  /* Loading State */
  .loading-state {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 3rem 0;
    color: #7f8c8d;
  }

  .spinner {
    border: 4px solid rgba(0, 0, 0, 0.1);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border-left-color: #49bbbd;
    animation: spin 1s linear infinite;
    margin-bottom: 1rem;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }

  /* Empty State */
  .empty-state {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 4rem 2rem;
    background: #f9f9f9;
    border-radius: 8px;
    margin: 2rem 0;
  }

  .empty-state i {
    font-size: 3rem;
    color: #e0e0e0;
    margin-bottom: 1rem;
  }

  .empty-state h3 {
    margin: 0 0 0.5rem 0;
    color: #2c3e50;
  }

  .empty-state p {
    color: #7f8c8d;
    margin-bottom: 1.5rem;
  }

  /* Short Card Styles */
  .short-card {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
  }

  .short-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
  }

  .short-thumbnail {
    position: relative;
    padding-top: 56.25%; /* 16:9 Aspect Ratio */
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .short-thumbnail i {
    font-size: 2.5rem;
    color: white;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .short-card:hover .short-thumbnail i {
    opacity: 1;
  }

  .short-duration {
    position: absolute;
    bottom: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 500;
  }

  .short-info {
    padding: 1rem;
  }

  .short-creator {
    display: flex;
    align-items: center;
    margin-bottom: 0.5rem;
  }

  .creator-avatar {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    margin-right: 8px;
  }

  .short-creator span {
    font-size: 0.9rem;
    color: #666;
  }

  .short-info h3 {
    margin: 0 0 0.75rem 0;
    font-size: 1rem;
    color: #2c3e50;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .short-stats {
    display: flex;
    gap: 1rem;
    font-size: 0.85rem;
    color: #7f8c8d;
  }

  .short-stats i {
    margin-right: 4px;
  }

  /* Responsive Grid */
  .shorts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;
  }

  @media (max-width: 768px) {
    .shorts-grid {
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    }
  }

  @media (max-width: 480px) {
    .shorts-grid {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
  // Filter functionality
  document.addEventListener("DOMContentLoaded", function () {
    const filterBtns = document.querySelectorAll(".filter-btn");
    filterBtns.forEach((btn) => {
      btn.addEventListener("click", function () {
        filterBtns.forEach((b) => b.classList.remove("active"));
        this.classList.add("active");
        // Here you would filter the shorts based on the selected filter
      });
    });
  });
</script>
